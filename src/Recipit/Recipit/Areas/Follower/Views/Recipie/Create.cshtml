<div class="cerate-post-container">
    <section class="create-post-section">
        <div class="create-post-title-container">
            <h1>Create a recipie</h1>
        </div>
        <div class="post-content-container">
            <div class="post-content-navigation-top">
                <a class="naligation-item" id="btn-post">
                    <i class="navigation-item-icon fa fa-list-ul"></i> Post
                </a>
                <a class="naligation-item" id="btn-image">
                    <i class="navigation-item-icon fa fa-image"></i> Image
                </a>
                <a class="naligation-item" id="btn-preview">
                    <i class="navigation-item-icon fa fa-magnifying-glass"></i> Preview
                </a>
            </div>
            <div class="post-content" id="text-content">
                <label class="label-select-category" for="cars">Choose a category:</label>
                <select class="select-select-category" name="cars" id="cars">
                    <option value="volvo">Volvo</option>
                    <option value="saab">Saab</option>
                    <option value="mercedes">Mercedes</option>
                    <option value="audi">Audi</option>
                </select> 
                <input id="postTitle" class="post-content-input-title" type="text" placeholder="Post title" />
                <textarea id="postDescription" class="post-content-input-description" rows="5"></textarea>
                <div class="products-select-container">
                    <button id="btn-add-product" class="button-add-product"><i class="fa-regular fa-circle-plus"></i> Add product</button>
                    <div id="product-container" class="added-products-container">
                        <div class="product">
                            <input type="hidden" id="product-id" value="1"/>
                            <img class="product-img" src="~/images/google-icon.png" alt="img">
                            <h1 class="product-name">Name</h1>
                        </div>
                    </div>
                </div>
                <div id="product-popup" class="product-popup hidden">
                    <input type="text" class="search-products" id="searchProduct" placeholder="Search for a product">
                    <ul id="product-list" class="product-list">
                    </ul>
                    <button class="add-new-product-btn" id="addNewProduct">Add New Product</button>
                </div>
                <input id="nutrition" class="post-content-input-title" type="number" placeholder="Nutrition" />
                <div class="bottom-btns-post">
                    <a class="post-content-btn hidden">Previous</a>
                    <a class="post-content-btn" id="text-display-image">Next</a>
                </div>
            </div>
            <div class="post-content hidden" id="image-content">
                <div class="post-content-image-container">
                    <input class="post-content-input-file" type="file" id="image" accept="image/*">
                </div>
                <div class="bottom-btns-post">
                    <a class="post-content-btn" id="display-text">Previous</a>
                    <a class="post-content-btn" id="display-preview">Next</a>
                </div>
            </div>
            <div class="post-content hidden" id="preview-content">
                <div class="dynamic-content" id="dynamic-content">
                </div>
                <div class="bottom-btns-post">
                    <a class="post-content-btn" id="preview-display-image">Previous</a>
                    <a class="post-content-btn" id="submitBtn">Submit</a>
                </div>
            </div>
        </div>
    </section>
    <section class="create-post-profile-display-section">
        <div class="profile-display-section-top">
            @if (User.Claims.FirstOrDefault(c => c.Type == "profile_picture")?.Value != null)
            {
                <img class="img-pfp-head" src="@User.Claims.FirstOrDefault(c => c.Type == "profile_picture")?.Value" alt="Image here." />
            }
            else
            {
                <img class="img-pfp-head" src="https://upload.wikimedia.org/wikipedia/commons/a/ac/Default_pfp.jpg" alt="Image here." />
            }
            <a class="post-content-btn" href="http://localhost:5001/profile">Edit Profile</a>
        </div>
        <div class="profile-display-section-bottom">
        </div>
    </section>
</div>

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    $(document).ready(function () {
        var productPopup = $('#product-popup');

        $('#btn-add-product').click(function () {
            productPopup.toggleClass('hidden');
            if (!productPopup.hasClass('hidden')) {
                populateProductList("");
            }
        });

        $('#searchProduct').on('input', function () {
            var searchTerm = $(this).val();
            populateProductList(searchTerm);
        });

        $('#addNewProduct').click(function () {
            // Handle adding a new product here
            alert("Add new product clicked!");
        });

        // Function to populate the product list based on the search term
        function populateProductList(searchTerm) {
            // In a real scenario, you would fetch the product data based on the search term
            // For now, let's assume a static list of products
            var products = ["Product 1", "Product 2", "Product 3"];

            // Clear the existing list
            $('#product-list').empty();

            // Populate the list with matching products
            for (var i = 0; i < products.length; i++) {
                if (products[i].toLowerCase().includes(searchTerm.toLowerCase())) {
                    var listItem = $('<li>').text(products[i]);
                    listItem.click(function () {
                        // Handle product selection here
                        var selectedProduct = $(this).text();
                        alert("Selected product: " + selectedProduct);
                        productPopup.addClass('hidden');
                    });
                    $('#product-list').append(listItem);
                }
            }
        }
    });
</script>

<script>
    $(document).ready(function () {
        $('#submitBtn').click(function () {
            var title = document.getElementById('postTitle').value;
            var description = document.getElementById('postDescription').value;
            var category = document.getElementById('cars').value;

            // Retrieve the list of product IDs
            var productIds = [];
            $('#product-container .product').each(function () {
                productIds.push($(this).find('#product-id').val());
            });

            var imageData = document.getElementById('image').files[0];

            var formData = new FormData();
            formData.append('Title', title);
            formData.append('Description', description);
            formData.append('Category', category);
            formData.append('ProductIds', productIds.join(',')); // Convert to comma-separated string
            formData.append('Image', imageData);

            $.ajax({
                url: '/posts/create',
                type: 'POST',
                processData: false,
                contentType: false,
                data: formData,
                success: function (data) {
                    console.log(data);
                },
                error: function (error) {
                    console.log(error);
                }
            });
        });
    });
</script>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var textContent = document.getElementById('text-content');
        var imageContent = document.getElementById('image-content');
        var previewContent = document.getElementById('preview-content');

        var btnPost = document.getElementById('btn-post');
        var btnImage = document.getElementById('btn-image');
        var btnPreview = document.getElementById('btn-preview');
        var btnSubmit = document.getElementById('submit');

        var textDisplayImage = document.getElementById('text-display-image');
        var displayText = document.getElementById('display-text');
        var displayPreview = document.getElementById('display-preview');
        var previewDisplayImage = document.getElementById('preview-display-image');

        function showContent(content) {
            textContent.classList.add('hidden');
            imageContent.classList.add('hidden');
            previewContent.classList.add('hidden');

            content.classList.remove('hidden');
        }

        showContent(textContent);

        btnPost.addEventListener('click', function () {
            showContent(textContent);
        });

        btnImage.addEventListener('click', function () {
            showContent(imageContent);
        });

        btnPreview.addEventListener('click', function () {
            showContent(previewContent);
        });

        textDisplayImage.addEventListener('click', function () {
            showContent(imageContent);
        });

        displayText.addEventListener('click', function () {
            showContent(textContent);
        });

        displayPreview.addEventListener('click', function () {
            showContent(previewContent);
        });

        previewDisplayImage.addEventListener('click', function () {
            showContent(imageContent);
        });
    });
</script>
<script>
    @{
        var imgUrl = "";
        var username = User.Claims.FirstOrDefault(c => c.Type == "username")?.Value;
        if (User.Claims.FirstOrDefault(c => c.Type == "profile_picture")?.Value != null)
        {
            imgUrl = User.Claims.FirstOrDefault(c => c.Type == "profile_picture")?.Value;
        }
        else
        {
            imgUrl = "https://upload.wikimedia.org/wikipedia/commons/a/ac/Default_pfp.jpg";
        }
    }

        var displayPreview = document.getElementById('display-preview');
    var btnPreview = document.getElementById('btn-preview');

    var imageUrl = '';
    var titleData = '';
    var descriptionData = '';

    document.getElementById('image').addEventListener('change', function (event) {
        var file = event.target.files[0];
        if (file) {
            var reader = new FileReader();
            reader.onload = function (e) {
                imageUrl = e.target.result;
            };
            reader.readAsDataURL(file);
            updatePreview();
        }
    });

    document.getElementById('postTitle').addEventListener('change', function (event) {
        titleData = event.target.value;
    });

    document.getElementById('postDescription').addEventListener('change', function (event) {
        descriptionData = event.target.value;
    });

    displayPreview.addEventListener('click', function () {
        updatePreview();
    });

    btnPreview.addEventListener('click', function () {
        updatePreview();
    });

    function updatePreview() {
        let cont = document.getElementById('dynamic-content');
        let previewHtml = `
                            <div class="post-container">
                           <header class="post-header">
                               <div class="post-header-info">
                                   <div class="post-header-image">
                                       <img class="header-img-data" src="@imgUrl" />
                                           <h1 class="header-img-text">@username</h1>
                                   </div>
                                   <div class="post-header-hour">
                                       <h1><strong>‧</strong></h1>
                                   </div>
                               </div>
                               <div class="post-header-buttons">
                                   <a class="follow-btn">1 minute ago</a>
                               </div>
                           </header>
                           <div class="post-content">
                               <div class="post-content-bg"></div>
                                   <h1 class="content-title">${titleData}</h1>
                                       <img class="uploaded-image-file" src="${imageUrl}" alt="Uploaded Image" />
                               <p class="content-text-container">
                                       ${descriptionData}
                               </p>
                           </div>
                           <div class="post-footer">
                               <div class="footer-buttons">
                                   <a class="footer-btn-action" href="#"><i class="fa fa-heart"></i> 0</a>
                                   <a class="footer-btn-action" href="#"><i class="fa fa-comment"></i> 0</a>
                                   <a class="footer-btn-action" href="#"><i class="fa fa-share"></i> Share</a>
                               </div>
                           </div>
                       </div>
                            `;

        cont.innerHTML = previewHtml;
    }
</script>